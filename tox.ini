[tox]
# Tox configuration file for testing across multiple Python versions

# Python versions to test
envlist = py38, py39, py310, py311, lint, type-check, security

# Skip missing interpreters
skip_missing_interpreters = True

# Minimum tox version
minversion = 3.24.0

[testenv]
# Base test environment configuration

# Dependencies
deps =
    pytest>=7.0.0
    pytest-cov>=4.0.0
    pytest-asyncio>=0.21.0
    pytest-mock>=3.10.0
    pytest-xdist>=3.0.0
    pytest-timeout>=2.1.0
    requests>=2.28.0
    httpx>=0.24.0
    factory-boy>=3.2.0
    faker>=18.0.0

# Commands to run
commands =
    pytest {posargs}

# Environment variables
setenv =
    PYTHONPATH = {toxinidir}
    COVERAGE_FILE = {envtmpdir}/.coverage
    PYTHONDONTWRITEBYTECODE = 1
    PYTHONHASHSEED = 0

# Use develop mode for faster testing
usedevelop = True

# Parallel execution
parallel_show_output = True

[testenv:py38]
# Python 3.8 specific configuration
basepython = python3.8

[testenv:py39]
# Python 3.9 specific configuration
basepython = python3.9

[testenv:py310]
# Python 3.10 specific configuration
basepython = python3.10

[testenv:py311]
# Python 3.11 specific configuration
basepython = python3.11

[testenv:lint]
# Linting environment
basepython = python3.10
deps =
    flake8>=5.0.0
    flake8-docstrings>=1.6.0
    flake8-import-order>=0.18.0
    flake8-bugbear>=22.0.0
    black>=22.0.0
    isort>=5.10.0
    bandit>=1.7.0

commands =
    flake8 src tests
    black --check --diff src tests
    isort --check-only --diff src tests
    bandit -r src

[testenv:type-check]
# Type checking environment
basepython = python3.10
deps =
    mypy>=1.0.0
    types-requests>=2.28.0
    types-PyYAML>=6.0.0

commands =
    mypy src

[testenv:security]
# Security scanning environment
basepython = python3.10
deps =
    safety>=2.3.0
    bandit>=1.7.0

commands =
    safety check
    bandit -r src

[testenv:docs]
# Documentation building environment
basepython = python3.10
deps =
    sphinx>=5.0.0
    sphinx-rtd-theme>=1.2.0
    sphinx-autodoc-typehints>=1.19.0

commands =
    sphinx-build -W -b html docs docs/_build/html

[testenv:coverage]
# Coverage reporting environment
basepython = python3.10
deps =
    {[testenv]deps}
    coverage[toml]>=7.0.0

commands =
    coverage erase
    pytest --cov=src --cov-report=term-missing --cov-report=html --cov-report=xml
    coverage report --fail-under=80

[testenv:integration]
# Integration tests environment
basepython = python3.10
deps =
    {[testenv]deps}
    docker>=6.0.0
    testcontainers>=3.7.0

commands =
    pytest tests/integration {posargs}

setenv =
    {[testenv]setenv}
    INTEGRATION_TESTS = 1

[testenv:e2e]
# End-to-end tests environment
basepython = python3.10
deps =
    {[testenv]deps}
    selenium>=4.8.0
    playwright>=1.32.0

commands =
    pytest tests/e2e {posargs}

setenv =
    {[testenv]setenv}
    E2E_TESTS = 1

[flake8]
# Flake8 configuration
max-line-length = 88
max-complexity = 10
select = E,W,F,C,B
ignore =
    E203,  # whitespace before ':'
    E501,  # line too long (handled by black)
    W503,  # line break before binary operator
    F401,  # imported but unused (handled by isort)

exclude =
    .git,
    __pycache__,
    .tox,
    .eggs,
    *.egg,
    build,
    dist,
    .venv,
    venv,
    env,
    migrations

per-file-ignores =
    __init__.py:F401
    tests/*:D

[isort]
# isort configuration
profile = black
line_length = 88
multi_line_output = 3
include_trailing_comma = True
force_grid_wrap = 0
use_parentheses = True
ensure_newline_before_comments = True

[coverage:run]
# Coverage run configuration (alternative to .coveragerc)
source = src
branch = True
parallel = True

[coverage:report]
# Coverage report configuration
show_missing = True
skip_covered = False
fail_under = 80
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.: